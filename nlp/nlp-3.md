---
title: Episode 3
slug: /docs/nlp-tutorial-L3
tags: [orchestration]
sidebar_label: Episode 3
id: nlp-tutorial-L3
description: A tutorial that uses Keras, Scikit-Learn, and Metaflow to operationalize a machine learning workflow.
category: tutorials
---


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! Instead, edit the notebook w/the location & name as this file. -->

### Setup Instructions

If you haven't done so, please follow the [setup instructions](./nlp-tutorial-setup) to prepare your environment.  This tutorial will references the python script [baselineflow.py](https://github.com/outerbounds/tutorials/blob/main/nlp/baselineflow.py).

#### What You Will Learn
At the end of this lesson, you will:
    
* Learn how to operationalize the tasks of loading data and to compute a baseline.
* Learn how to run and view tasks with Metaflow.

In Lesson 2, you saw how we constructed a model in preparation for Metaflow.  In this lesson, we will construct a basic flow that reads our data and reports a baseline.

### <NumberHeading number={1}>Creating A Baseline</NumberHeading>


When creating flows, we recommend starting simple: create a flow that reads your data and reports a baseline metric.  This way, you can ensure you have the right foundation to incorporate your model.  Furthermore, starting simple helps with debugging.

<Wrapper>

### <NumberHeading number={2}>Write A Flow</NumberHeading>

<Highlight>


For our baseline flow, we will just have three steps a `start` step where we read the data, a `baseline` step, and an `end` step that will be a placeholder for now.

</Highlight>


Below is a detailed explanation of each step:

1. **Read data from a parquet file** in the `start` step.
    - We use pandas to read `train.parquet`
    - Notice how we are assigning the training data to `self.df` and the validation data to `self.valdf` this stores the data as an artifact in Metaflow, which means it will be versioned and saved in the artifact store for later retrieval.  Furthermore, this allows you to pass data to another step.  The prerequisite for being able to do this is that the data you are trying to store must be pickleable.
    - We log the number of rows in the data.  It is always a good idea to log information about your dataset for debugging. 
2. **Compute the baseline** in the `baseline` step.
     - The `baseline` step records the performance metrics (accuracy and roc auc score) that result from classifying all examples with the majority class.  This will be our baseline against which we evaluate our model.
3. **Print the baseline metrics** in the `end` step.  
    - This is just a placeholder for now, but also serves to illustrate how you can retrieve artifacts from any step.

<RHS>



```py title="baselineflow.py"
from metaflow import FlowSpec, step, Flow, current

class BaselineNLPFlow(FlowSpec):
        
    @step
    def start(self):
        "Read the data"
        import pandas as pd
        self.df = pd.read_parquet('train.parquet')
        self.valdf = pd.read_parquet('valid.parquet')
        print(f'num of rows: {self.df.shape[0]}')
        self.next(self.baseline)

    @step
    def baseline(self):
        "Compute the baseline"
        from sklearn.metrics import accuracy_score, roc_auc_score
        baseline_predictions = [1] * self.valdf.shape[0]
        self.base_acc = accuracy_score(self.valdf.labels, baseline_predictions)
        self.base_rocauc = roc_auc_score(self.valdf.labels, baseline_predictions)
        self.next(self.end)
        
    @step
    def end(self):
        print(f'Baseline Accuracy: {self.base_acc:.3f}\nBaseline AUC: {self.base_rocauc}')
        

if __name__ == '__main__':
    BaselineNLPFlow()
```

</RHS>


### <NumberHeading number={3}>Run Flow</NumberHeading>



```bash
python baselineflow.py run
```

<CodeOutputBlock lang="bash">

```
     Workflow starting (run-id 1660234167860082):
     [1660234167860082/start/1 (pid 28912)] Task is starting.
     [1660234167860082/start/1 (pid 28912)] num of rows: 20377
     [1660234167860082/start/1 (pid 28912)] Task finished successfully.
     [1660234167860082/baseline/2 (pid 28916)] Task is starting.
     [1660234167860082/baseline/2 (pid 28916)] Task finished successfully.
     [1660234167860082/end/3 (pid 28920)] Task is starting.
     [1660234167860082/end/3 (pid 28920)] Baseline Accuracy: 0.773
     [1660234167860082/end/3 (pid 28920)] Baseline AUC: 0.5
     [1660234167860082/end/3 (pid 28920)] Task finished successfully.
     Done!
```

</CodeOutputBlock>

</Wrapper>


### Next Steps

In the next lesson, you will learn how to incorporate your model into the flow as well as deal with branching for parallel runs.
